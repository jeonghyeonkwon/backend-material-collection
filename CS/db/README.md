# CS 전공 지식 - DB

## MySQL

### 아키텍처

- MySQL 접속 클라이언트 (접속 api)
  - MySQL Connectors
    - JDBC, NodeJS, Phyton, .NET, ODBC, PHP, Ruby... 등 각 언어에서 접속 할 수 있는 api
  - MySQL Shell
    - 쉘 스크립트를 통해 접속 가능하게 해주는 api
- MySQL 엔진(클라이언트 접속, SQL 요청 처리)
  - NoSQL
  - SQL Interface
  - Parser
  - Optimizer
    - 요청된 SQL문을 최적화 시키기 위해 실행 계획 짜는 중요한 역할
  - Caches & Buffers
- MySQL 스토리지 엔진 (디스크 저장, 읽어 오는 역할 수행)
  - InnoDB
  - MyISAM
  - Memory
  - ...
- 운영체제, 하드웨어
  - 실제 테이블 데이터, 로그 데이터 파일로 저장

### 쿼리 실행 과정

1. 쿼리 캐시

- SQL 실행 결과를 메모리에 캐싱하는 역할
- 동일 SQL 실행시 이전 결과 즉시 반환
- 테이블의 데이터가 변경되면 캐싱된 데이터 삭제 필요 (동시 처리 성능 저하)
- MySQL 8.0 부터 완전히 제거

2. 쿼리 파서

- SQL 문장을 토큰으로 쪼개서 트리로 만듬
- 이 과정에서 쿼리 문장의 기본 문법 오류를 체크

3. 전처리기

- 쿼리 파서에서 만든 Parser tree를 기반으로 SQL 문장 구조를 체크
- Parser tree의 토큰이 유효한지 체크
  - 토큰에 해당하는 테이블 이름이나 컬럼 등이 실제 존재 여부 체크
  - 접근 권한 체크

4. 옵티마이저

- SQL 실행을 최적화해서 실행 계획을 수립
- 규칙 기반 최적화
  - 옵티마이저에 내장된 우선순위에 따라 실행 계획을 수립
- 비용 기반 최적화
  - 작업의 비용과 대상 테이블의 통계 정보를 활용해서 실행 계획 수립

5. 쿼리 실행 엔진

- 옵티마이저가 만든 실행 계획대로 스토리지 엔진을 호출해서 레코드를 읽고 씀

6. 스토리지 엔진

- 쿼리 실행 엔진이 요청하는대로 데이터를 디스크로 저장하고 읽음
- 핸들러 API에 의해 동작
- 핸들러라고도 불림
- 플러그인 형태로 제공
  - InnoDB
  - MyISAM
  - Memory
  - ...
- 플러그인 끼리는 통신할 수 없음

### InnoDB 스토리지 엔진

- MySQL 8.0 기본 엔진, 다른 엔진으로 변경 가능
- 행 인덱스 조회 캐싱
  - 엔진 자체 내에서 행 캐시와 인덱스 캐시를 결합하여 작업
- 행 수준 잠금
- 트랜잭션 처리, 대용량 데이터 다루기에 좋다

### MyISAM

- 트랜잭션 처리 불가
- 행 인덱스 조회 캐싱
  - 파일 시스템 블록 캐시
- 트랜잭션 처리 못함
- 테이블 수준 잠금
- 외래키 지원 X
- 테이블에 Row Count 가지고 있어 조회 시 빠르다

### 출처 및 자료

- [[10분 테코톡] 🔫 우기의 MySQL 아키텍처](https://www.youtube.com/watch?v=vQFGBZemJLQ)
